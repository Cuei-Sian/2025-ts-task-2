import{a as J,r as g,d as z,u as T,o as O,b as K,w as Q,c as Y,e as b,f,g as e,t as y,h as l,i as _,v as h,j as Z,k as ee,l as te,m as q,F as P,n as R,p as D,q as E}from"./index-DtnEBahS.js";import{M as le,_ as oe}from"./DeleteModal.vue_vue_type_script_setup_true_lang-D0S-5Du5.js";const se="https://ec-course-api.hexschool.io;",V="doreenwang",$=J.create({baseURL:se});$.interceptors.request.use(s=>{const n=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return n&&(s.headers.Authorization=n),s},s=>Promise.reject(s));$.interceptors.response.use(s=>Promise.resolve(s),s=>Promise.reject(s.response.data));const ae=s=>$.get(`/v2/api/${V}/admin/products`,{params:s}),ne=s=>$.post(`/v2/api/${V}/admin/product`,{data:s}),ie=s=>{const{data:n,id:m}=s;return $.put(`/v2/api/${V}/admin/product/${m}`,{data:n})},re=async s=>$.post(`/v2/api/${V}/admin/upload`,s),I=4;function de(s){try{const n=new URL(s);return["http:","https:"].includes(n.protocol)}catch{return!1}}async function ue(s){const n=new FormData;n.append("file-to-upload",s);try{return(await re(n)).data.imageUrl}catch(m){throw alert("上傳圖片失敗"),m}}function ce(s=[]){const n=g([...s]),m=g(""),d=g("未選擇檔案。"),p=g(null),c=g(!1);return{uploadedImages:n,imageUrlInput:m,fileNameDisplay:d,fileToUpload:p,isUploading:c,addImageUrl:()=>{const a=m.value.trim();if(a){if(n.value.length>=I){alert(`最多只能上傳 ${I} 張圖片`);return}if(!de(a)){alert("請輸入有效的圖片 URL 格式 (需包含 http:// 或 https://)");return}n.value.push(a),m.value=""}},handleFileChange:a=>{const i=a.target,r=i.files?.[0];if(i.value="",!r){d.value="未選擇檔案。",p.value=null;return}if(!r.type.startsWith("image/")){alert("請選擇有效的圖片檔案！"),d.value="未選擇檔案。",p.value=null;return}if(n.value.length>=I){alert(`最多只能上傳 ${I} 張圖片！`),d.value="圖片數量已達上限，請先刪除圖片。",p.value=null;return}p.value=r,d.value=r.name},triggerUpload:async()=>{const a=p.value;if(!a){alert("請先選擇圖片檔案");return}if(!c.value)try{c.value=!0;const i=await ue(a);n.value.push(i),p.value=null,d.value="未選擇檔案。",alert("圖片上傳成功！")}catch(i){console.error("圖片上傳失敗:",i),alert("圖片上傳失敗，請稍後再試。")}finally{c.value=!1}},deleteImage:a=>{n.value.splice(a,1)},resetImages:(a=[])=>{n.value=[...a].filter(Boolean),m.value="",d.value="未選擇檔案。",p.value=null,c.value=!1}}}const G=()=>({id:"",title:"",origin_price:0,price:0,category:"",unit:"",num:0,content:"",description:"",is_enabled:1,imageUrl:"",imagesUrl:[""]});function pe(){const s=g(G()),n=g("新增商品"),m=p=>{p?(s.value={...p},n.value="編輯商品"):d()},d=()=>{s.value=G(),n.value="新增商品"};return{form:s,formTitle:n,loadProduct:m,resetForm:d}}const me={class:"modal-dialog modal-dialog-centered modal-lg"},ge={class:"modal-content rounded-lg"},be={class:"modal-header"},fe={class:"modal-title",id:"addNewProductModalLabel"},ve={class:"modal-body"},_e={class:"row"},he={class:"col-md-6"},ye={class:"mb-3"},Ue={class:"row"},ke={class:"col-6 mb-3"},$e={class:"col-6 mb-3"},xe={class:"row"},we={class:"col-6 mb-3"},Ce={class:"col-6 mb-3"},Pe={class:"mb-3"},Me={class:"mb-3"},Ie={class:"mb-3 d-flex align-items-center"},De={class:"form-check form-switch"},Re={class:"col-md-6"},Ve={class:"mb-3"},Fe={class:"input-group mb-2"},Ne=["disabled"],Se={class:"input-group mb-2"},je={class:"file-name-display form-control rounded-lg"},Te=["disabled"],Le={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ae={class:"mb-3"},Be={id:"imagesContainer",class:"d-flex flex-wrap gap-2"},Ee=["src"],Ge=["onClick"],ze=["src"],Oe={class:"modal-footer"},qe=["disabled"],He=z({__name:"ProductModal",props:{product:{}},emits:["get-products"],setup(s,{expose:n,emit:m}){const d=m,p=T("modalRef");let c=null;O(()=>{p.value&&(c=new le(p.value))}),K(()=>{c&&c.dispose()});const x=()=>{c&&c.show()},k=()=>{c&&c.hide()},{form:u,formTitle:w,loadProduct:C}=pe(),{uploadedImages:a,imageUrlInput:i,fileToUpload:r,fileNameDisplay:M,isUploading:F,addImageUrl:L,triggerUpload:A,handleFileChange:B,deleteImage:H,resetImages:N}=ce();Q(()=>s.product,U=>{U.id?(C(U),N([U.imageUrl,...U.imagesUrl])):(C(null),N([]))},{immediate:!0,deep:!0});const W=Y(()=>!!s.product.id),S=g(!1),X=async()=>{const[U,...t]=a.value,{id:o,...v}=u.value;v.imageUrl=U,v.imagesUrl=t;const j={...v,imagesUrl:v.imagesUrl?v.imagesUrl:[""]};S.value=!0;try{W.value&&o?await ie({data:j,id:o}):await ne(j),N([]),k()}catch{alert("新增/編輯產品失敗")}finally{S.value=!1,d("get-products")}};return n({openModal:x,closeModal:k}),(U,t)=>(f(),b("div",{ref_key:"modalRef",ref:p,class:"modal fade",id:"addNewProductModal",tabindex:"-1","aria-labelledby":"addNewProductModalLabel","aria-hidden":"true"},[e("div",me,[e("div",ge,[e("div",be,[e("h5",fe,y(l(w)),1),e("button",{onClick:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",ve,[e("div",_e,[e("div",he,[e("form",null,[e("div",ye,[t[12]||(t[12]=e("label",{for:"productName",class:"form-label"},"商品名稱",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l(u).title=o),type:"text",class:"form-control rounded-lg",id:"productName"},null,512),[[h,l(u).title]])]),e("div",Ue,[e("div",ke,[t[13]||(t[13]=e("label",{for:"productOriginalPrice",class:"form-label"},"原價",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l(u).origin_price=o),type:"number",class:"form-control rounded-lg",id:"productOriginalPrice"},null,512),[[h,l(u).origin_price]])]),e("div",$e,[t[14]||(t[14]=e("label",{for:"productPrice",class:"form-label"},"售價",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>l(u).price=o),type:"number",class:"form-control rounded-lg",id:"productPrice"},null,512),[[h,l(u).price]])])]),e("div",xe,[e("div",we,[t[15]||(t[15]=e("label",{for:"productCategory",class:"form-label"},"分類",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>l(u).category=o),class:"form-control rounded-lg",id:"productCategory"},null,512),[[h,l(u).category]])]),e("div",Ce,[t[16]||(t[16]=e("label",{for:"productUnit",class:"form-label"},"單位",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>l(u).unit=o),class:"form-control rounded-lg",id:"productUnit"},null,512),[[h,l(u).unit]])])]),e("div",Pe,[t[17]||(t[17]=e("label",{for:"productDescription",class:"form-label"},"商品內容",-1)),_(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>l(u).content=o),class:"form-control rounded-lg",id:"productDescription",rows:"4"},null,512),[[h,l(u).content]])]),e("div",Me,[t[18]||(t[18]=e("label",{for:"productDescription",class:"form-label"},"商品描述",-1)),_(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=o=>l(u).description=o),class:"form-control rounded-lg",id:"productDescription",rows:"4"},null,512),[[h,l(u).description]])]),e("div",Ie,[t[19]||(t[19]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",De,[_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>l(u).is_enabled=o),class:"form-check-input",type:"checkbox",id:"flexSwitchProductEnable","true-value":1,"false-value":0},null,512),[[Z,l(u).is_enabled]])])])])]),e("div",Re,[e("div",Ve,[t[21]||(t[21]=e("label",{class:"form-label"},"上傳圖片 (最多 4 張)",-1)),e("div",Fe,[_(e("input",{type:"url",class:"form-control rounded-lg",placeholder:"輸入圖片連結","onUpdate:modelValue":t[8]||(t[8]=o=>ee(i)?i.value=o:null)},null,512),[[h,l(i)]]),e("button",{class:"btn btn-outline-secondary rounded-lg ms-2",type:"button",onClick:t[9]||(t[9]=(...o)=>l(L)&&l(L)(...o)),disabled:l(a).length>=4}," 新增連結 ",8,Ne)]),e("div",Se,[t[20]||(t[20]=e("label",{class:"input-group-text rounded-lg",for:"imageInputFile"},"瀏覽...",-1)),e("input",{onChange:t[10]||(t[10]=(...o)=>l(B)&&l(B)(...o)),type:"file",class:"form-control d-none",id:"imageInputFile",accept:".jpg, .jpeg, .png"},null,32),e("div",je,y(l(M)),1),e("button",{onClick:t[11]||(t[11]=(...o)=>l(A)&&l(A)(...o)),disabled:!l(r)||l(F)||l(a).length>=4,class:"btn btn-outline-secondary rounded-lg ms-2",type:"button"},[l(F)?(f(),b("span",Le)):te("",!0),q(" "+y(l(F)?"上傳中...":"上傳圖片"),1)],8,Te)])]),e("div",Ae,[t[23]||(t[23]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("label",{class:"form-label mb-0"},"已上傳圖片")],-1)),e("div",Be,[(f(!0),b(P,null,R(l(a),(o,v)=>(f(),b("div",{key:v,class:D(["image-preview-thumbnail-container",{"main-image":v===0}])},[e("img",{src:o,class:"image-preview-thumbnail",alt:"商品圖片預覽"},null,8,Ee),e("button",{class:"btn btn-danger btn-sm delete-btn",onClick:j=>l(H)(v)},[...t[22]||(t[22]=[e("i",{class:"fas fa-times"},null,-1)])],8,Ge)],2))),128)),(f(!0),b(P,null,R(4-l(a).length,o=>(f(),b("div",{key:"placeholder-"+o,class:"image-preview-thumbnail-container"},[e("img",{src:`https://placehold.co/100x100/e9ecef/adb5bd?text=Image+${l(a).length+o}`,class:"image-preview-thumbnail"},null,8,ze)]))),128))])])])])]),e("div",Oe,[e("button",{onClick:k,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:X,disabled:S.value,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,qe)])])])],512))}}),We={class:"d-flex justify-content-end align-items-center mb-4"},Xe={class:"card shadow-sm rounded-lg flex-grow-1"},Je={class:"card-body p-4"},Ke={class:"table-responsive"},Qe={class:"table table-hover align-middle"},Ye={class:"text-center"},Ze={class:"form-check form-switch d-flex justify-content-center align-items-center"},et=["checked"],tt={class:"text-nowrap"},lt=["onClick"],ot=["onClick"],st={class:"d-flex justify-content-center mt-4"},at={class:"pagination"},nt={class:"page-item"},it=["disabled"],rt=["onClick","disabled"],dt={class:"page-item"},ut=["disabled"],gt=z({__name:"ProductManagement",setup(s){const n=T("productModalRef"),m=T("deleteModalRef"),d=g("1"),p=g([]),c=g({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),x=async()=>{try{const a=await ae({page:d.value});p.value=a.data.products,c.value=a.data.pagination}catch{alert("取得產品列表失敗")}};O(()=>{x()});const u=g({id:"",title:"",origin_price:0,price:0,category:"",unit:"",num:0,content:"",description:"",is_enabled:1,imageUrl:"",imagesUrl:[""]}),w=(a=null)=>{a&&(u.value={...a,imagesUrl:a.imagesUrl?[...a.imagesUrl]:[""]}),n.value?.openModal()},C=a=>{m.value?.openModal()};return(a,i)=>(f(),b(P,null,[e("div",We,[e("button",{onClick:i[0]||(i[0]=r=>w(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...i[3]||(i[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),q("新增商品 ",-1)])])]),e("div",Xe,[e("div",Je,[e("div",Ke,[e("table",Qe,[i[4]||(i[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"商品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(f(!0),b(P,null,R(p.value,r=>(f(),b("tr",{key:r.id},[e("td",null,y(r.category),1),e("td",null,y(r.title),1),e("td",null,y(r.origin_price),1),e("td",null,y(r.price),1),e("td",Ye,[e("div",Ze,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!r.is_enabled},null,8,et)])]),e("td",tt,[e("button",{onClick:M=>w(r),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,lt),e("button",{onClick:M=>C(r.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,ot)])]))),128))])])]),e("nav",st,[e("ul",at,[e("li",nt,[e("button",{onClick:i[1]||(i[1]=r=>d.value=String(Number(d.value)-1)),disabled:!c.value?.has_pre,type:"button",class:D(["page-link",{disabled:!c.value?.has_pre}]),"aria-label":"Previous"},[...i[5]||(i[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,it)]),(f(!0),b(P,null,R(c.value?.total_pages,r=>(f(),b("li",{class:"page-item",key:r},[e("button",{onClick:M=>d.value=r.toString(),disabled:d.value===r.toString(),type:"button",class:D(["page-link",{active:d.value===r.toString()}])},y(r),11,rt)]))),128)),e("li",dt,[e("button",{onClick:i[2]||(i[2]=r=>d.value=String(Number(d.value)+1)),disabled:!c.value?.has_next,class:D(["page-link",{disabled:!c.value?.has_next}]),type:"button","aria-label":"Next"},[...i[6]||(i[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,ut)])])])])]),E(He,{ref_key:"productModalRef",ref:n,product:u.value,onGetProducts:x},null,8,["product"]),E(oe,{ref_key:"deleteModalRef",ref:m,title:"刪除商品",content:"確定要刪除該商品嗎？"},null,512)],64))}});export{gt as default};
